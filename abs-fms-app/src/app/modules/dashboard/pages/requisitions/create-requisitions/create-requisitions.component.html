<!-- Create Requisitions Page -->
<div class="create-requisitions-container">
  <!-- Header with Action Buttons -->
  <div class="header-section">
    <h2>Create Requisitions</h2>
    <div class="action-buttons">
      <button mat-raised-button color="primary" (click)="openSearchModal()">
        <mat-icon>search</mat-icon>
        Search
      </button>
      <button mat-raised-button color="accent" (click)="openCreateRequisitionModal()">
        <mat-icon>add</mat-icon>
        Create Requisition
      </button>
      <button mat-raised-button color="warn" (click)="openCreatePayeeModal()">
        <mat-icon>person_add</mat-icon>
        Create Payee
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <!-- <div class="content-section"> -->
  <div class="content-sectio">
    <!-- <p>Select an action from the buttons above to get started.</p> -->
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>

  <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      {{ column }}
    </th>

    <td mat-cell *matCellDef="let element">

      <!-- Default cell content -->
      <ng-template #normalCell>
        {{ element[column] }}
      </ng-template>

      <ng-container *ngIf="column === 'actions'; else normalCell">
        <button mat-button color="primary" (click)="authorize(element)">Authorize </button>

        <button mat-button color="warn" (click)="reject(element)">Reject </button>

        <!-- 3-dot menu -->
        <button mat-icon-button [matMenuTriggerFor]="actionMenu" aria-label="Actions"><mat-icon>more_horiz</mat-icon></button>

          
        <!-- Dropdown for edit/view/delete -->
        <mat-menu #actionMenu="matMenu">
          <button mat-menu-item (click)="viewDetails(element)">
            <mat-icon>visibility</mat-icon>
            <span>View details</span>
          </button>
          <button mat-menu-item>
            <mat-icon>edit</mat-icon>
            <span>Edit</span>
          </button>
          <button mat-menu-item>
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        </mat-menu>
      </ng-container>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

</table>
<mat-paginator [pageSize]="8" [pageSizeOptions]="[10, 25, 50, 100]"></mat-paginator>

  </div>
</div>

<!-- Create Requisition Modal -->
<div class="modal-overlay" *ngIf="showCreateRequisitionModal" (click)="closeCreateRequisitionModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Create New Requisition</h3>
      <button mat-icon-button (click)="closeCreateRequisitionModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <form class="modal-body" [formGroup]="requisitionForm">
        <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Payee</mat-label>
            <input matInput formControlName="payee" placeholder="Enter payee name"
                   (blur)="onPayeeChange(); onPayeeNameChange()">
            <mat-error *ngIf="hasError('payee')">
              {{ getErrorMessage('payee') }}
            </mat-error>
          </mat-form-field>
      </div>
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Code</mat-label>
          <input matInput formControlName="code" placeholder="Enter requisition code">
          <mat-error *ngIf="hasError('code')">
              {{ getErrorMessage('code') }}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Input Cheque Payee</mat-label>
          <input matInput formControlName="chequePayee" placeholder="Enter payee name">
          <mat-error *ngIf="hasError('chequePayee')">
              {{ getErrorMessage('chequePayee') }}
            </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Payee Bank Branch</mat-label>
          <mat-select formControlName="payeeBankBranch">
                          <mat-option value="">-- Select Bank Branch --</mat-option>
            <mat-option *ngFor="let branch of bankBranches; trackBy: trackByValue" [value]="branch.value" >
              {{branch.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Payee Account No</mat-label>
          <input matInput formControlName="payeeAccountNo" placeholder="Enter account number">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Narrative</mat-label>
          <textarea matInput formControlName="narrative" rows="3" placeholder="Enter narrative"></textarea>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Invoice No</mat-label>
          <input matInput formControlName="invoiceNo" placeholder="Enter invoice number">
           <mat-error *ngIf="hasError('invoiceNo')">
              {{ getErrorMessage('invoiceNo') }}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
            <mat-label>Invoice Date *</mat-label>
            <input matInput [matDatepicker]="invoicePicker" formControlName="invoiceDate"
                   readonly placeholder="Select invoice date"
                   [max]="getTodayDate()">
            <mat-datepicker-toggle matSuffix [for]="invoicePicker"></mat-datepicker-toggle>
            <mat-datepicker #invoicePicker [startAt]="getTodayDate()"></mat-datepicker>
            <mat-hint>Invoice date can't be a future date</mat-hint>
            <mat-error *ngIf="hasError('invoiceDate')">
              {{ getErrorMessage('invoiceDate') }}
            </mat-error>
          </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Amount</mat-label>
          <input matInput type="number" formControlName="amount" placeholder="0.00" min="0" step="0.01">
           <mat-error *ngIf="hasError('amount')">
              {{ getErrorMessage('amount') }}
            </mat-error>
        </mat-form-field>

        <!-- <mat-form-field appearance="outline" class="half-width">
          <mat-label>Currency</mat-label>
          <mat-select formControlName="currency">
            <mat-option *ngFor="let currency of currencies" [value]="currency.code">
              {{currency.name}} ({{currency.code}})
            </mat-option>
          </mat-select>
        </mat-form-field> -->
      
    <mat-form-field appearance="outline" class="half-width">
            <mat-label>Currency </mat-label>
            <mat-select formControlName="currency">
              <mat-option *ngFor="let currency of currencies" [value]="currency.value">
                {{ currency.symbol }} - {{ currency.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Default: Nigerian Naira (â‚¦)</mat-hint>
            <mat-error *ngIf="hasError('currency')">
              {{ getErrorMessage('currency') }}
            </mat-error>
          </mat-form-field>
    </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Bank Account *</mat-label>
            <mat-select formControlName="bankAccount">
              <mat-option value="">-- Select Bank Account --</mat-option>
              <mat-option *ngFor="let account of bankAccounts" [value]="account.value">
                {{ account.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Choose the account to debit</mat-hint>
            <mat-error *ngIf="hasError('bankAccount')">
              {{ getErrorMessage('bankAccount') }}
            </mat-error>
          </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
            <mat-label>Type *</mat-label>
            <mat-select formControlName="type">
              <mat-option value="">-- Select Payee Type --</mat-option>
              <mat-option *ngFor="let type of payeeTypes" [value]="type.value">
                {{ type.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Select the category of payee</mat-hint>
            <mat-error *ngIf="hasError('type')">
              {{ getErrorMessage('type') }}
            </mat-error>
          </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
            <mat-label>Payment Option *</mat-label>
            <mat-select formControlName="paymentOption">
              <mat-option value="">-- Select Payment Method --</mat-option>
              <mat-optgroup label="Electronic Transfers">
                <mat-option *ngFor="let option of paymentOptions.slice(0, 3)" [value]="option.value">
                  {{ option.name }}
                </mat-option>
              </mat-optgroup>
              <mat-optgroup label="Traditional Methods">
                <mat-option *ngFor="let option of paymentOptions.slice(3, 7)" [value]="option.value">
                  {{ option.name }}
                </mat-option>
              </mat-optgroup>
              <mat-optgroup label="Digital & Mobile">
                <mat-option *ngFor="let option of paymentOptions.slice(7)" [value]="option.value">
                  {{ option.name }}
                </mat-option>
              </mat-optgroup>
            </mat-select>
            <mat-hint>Choose the payment method</mat-hint>
            <mat-error *ngIf="hasError('paymentOption')">
              {{ getErrorMessage('paymentOption') }}
            </mat-error>
          </mat-form-field>
      </div>
    </form>

    <div class="modal-footer">
      <button mat-button (click)="closeCreateRequisitionModal()">Cancel</button>
      <button mat-raised-button color="primary" (click)="saveRequisition()">Save</button>
    </div>
  </div>
</div>

<!-- Create Payee Modal -->
<div class="modal-overlay" *ngIf="showCreatePayeeModal" (click)="closeCreatePayeeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Create New Payee</h3>
      <button mat-icon-button (click)="closeCreatePayeeModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <form class="modal-body" [formGroup]="payeeForm">
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Payee Name</mat-label>
          <input matInput formControlName="payeeName" placeholder="Enter payee name">
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Payee Code</mat-label>
          <input matInput formControlName="payeeCode" placeholder="Enter payee code">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Bank Name</mat-label>
          <input matInput formControlName="bankName" placeholder="Enter bank name">
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Payee Bank Branch</mat-label>
          <mat-select formControlName="bankBranch">
            <mat-option *ngFor="let branch of bankBranches; trackBy: trackByValue" [value]="branch.value" >
              {{branch.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Account Number</mat-label>
          <input matInput formControlName="accountNumber" placeholder="Enter account number">
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
            <mat-label>Type *</mat-label>
            <mat-select formControlName="payeeType">
              <mat-option value="">-- Select Payee Type --</mat-option>
              <mat-option *ngFor="let type of payeeTypes" [value]="type.value">
                {{ type.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Select the category of payee</mat-hint>
            <mat-error *ngIf="hasError('type')">
              {{ getErrorMessage('type') }}
            </mat-error>
          </mat-form-field>

      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Contact Information</mat-label>
          <textarea matInput formControlName="contactInfo" rows="2" placeholder="Enter contact details"></textarea>
        </mat-form-field>
      </div>
    </form>

    <div class="modal-footer">
      <button mat-button (click)="closeCreatePayeeModal()">Cancel</button>
      <button mat-raised-button color="primary" (click)="savePayee()">Save Payee</button>
    </div>
  </div>
</div>
